name: Run Tests

on:
  # Solo correr tests en Pull Requests, no en push a main
  pull_request:
    branches:
      - main
      - develop
  # Permitir ejecuciÃ³n manual desde GitHub UI
  workflow_dispatch:

jobs:
  test-frontend:
    name: Test Frontend
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Install dependencies
        run: npm ci

      - name: ğŸ§ª Run Frontend Tests
        run: npm run test:frontend

  test-backend:
    name: Test Backend
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Install root dependencies
        run: npm ci

      - name: ğŸ“¥ Install backend dependencies
        run: cd backend && npm ci

      - name: ğŸ§ª Run Backend Tests
        run: npm run test:backend

  summary:
    name: Test Summary
    runs-on: ubuntu-latest
    needs: [test-frontend, test-backend]
    if: always()

    steps:
      - name: âœ… All tests passed
        if: ${{ needs.test-frontend.result == 'success' && needs.test-backend.result == 'success' }}
        run: echo "ğŸ‰ All tests passed successfully!"

      - name: âŒ Some tests failed
        if: ${{ needs.test-frontend.result != 'success' || needs.test-backend.result != 'success' }}
        run: |
          echo "âŒ Some tests failed"
          exit 1
